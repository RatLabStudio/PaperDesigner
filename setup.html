<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Display Settings | Rat Lab Studio</title>
    <style>
      :root {
        --cadet: rgb(105, 189, 192);
        --blue: rgb(108, 224, 228);
        --bluegreen: rgb(47, 255, 150);
        --yellow: rgb(244, 210, 72);
        --orange: rgb(234, 150, 47);
        --red: rgb(242, 102, 77);
        --pink: rgb(244, 27, 244);
        --backgroundColor: rgb(36, 36, 36);
        --lighterBackground: rgb(43, 43, 43);
        --evenLighterBackground: rgb(53, 53, 53);
      }

      @keyframes slideIn {
        from {
          transform: translateX(-100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      html,
      body {
        background-color: var(--backgroundColor);
        margin: 0;
        padding: 0;
        color: white;
        font-family: sans-serif;
        height: 100%;
        overflow: hidden;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      h1 {
        font-size: 5vh;
        text-align: center;
        margin-top: 5vh;

        color: var(--blue);
      }

      p {
        font-size: 3vh;
        max-width: 70%;
        margin: auto;
      }

      a {
        color: var(--yellow);
      }

      button {
        font-size: 3vh;
        padding: 1vh;
        color: #e5c53e;
        margin: 0;
        background-color: rgba(255, 255, 255, 0.1);
        border: solid 2px #e5c53e;
        border-radius: 1vh;
        cursor: pointer;
        transition: background-color 0.2s ease;
        box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.5);
      }

      button:hover {
        background-color: rgba(255, 255, 255, 0.25);
      }

      button:active {
        background-color: rgba(255, 255, 255, 0.5);
      }

      #ribbon {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 30px;
        background-color: var(--evenLighterBackground);
        margin: 0;
        z-index: 9;
        cursor: pointer;
        box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.5);
      }

      #mobileRibbon {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 11vh;
        background-color: rgba(58, 58, 58, 0.75);
        box-shadow: 0px 0px 8px black;
        backdrop-filter: blur(5px);
        z-index: 8;
      }

      .windowButton {
        width: 16px;
        height: 16px;
        padding: 0;
        border: none;
        position: relative;
        top: 50%;
        margin-left: 10px;
        transform: translateY(-50%);
        box-shadow: none;
      }

      #sidebar {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        margin: 0;
        background-color: var(--lighterBackground);
        padding: 0% 2% 0% 2%;
        z-index: 1;
        padding-left: 5vh;
        box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.5);
      }

      #sidebar.animate {
        animation: slideIn 0.4s ease-out forwards;
      }

      #sidebar button {
        min-width: 75%;
        color: var(--bluegreen);
        border-color: var(--bluegreen);
      }

      #documentBody {
        background-color: var(--backgroundColor);
        position: absolute;
        top: 0;
        right: 0;
        height: 100%;
        margin: 0;
        text-align: center;
        overflow-y: scroll;
      }

      .page {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        margin: 0;
      }

      input,
      select {
        background-color: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 3vh;
        border: solid 2px white;
        border-radius: 1vh;
        padding: 1vh;
        box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.5);
      }

      #networkOptions {
        width: 75%;
        max-width: 500px;
      }

      .passwordContainer {
        display: flex;
        width: 75%;
        max-width: 500px;
        gap: 1vh;
        margin: auto;
      }

      #password {
        width: 100%;
      }

      option {
        background-color: white;
        color: black;
        border: solid 1px black;
        border-radius: 1vh;
      }

      .toggle {
        min-width: 12vh;
        max-width: 100%;
        overflow: hidden;
      }

      canvas {
        position: relative;
        width: 75%;
        transform: none;
        top: none;
        left: none;
        margin: auto;
        transform: translateX(-64%);
      }

      .setupOptions {
        display: grid;
        grid-template-columns: 50% 50%;
        gap: 1vh;
        margin: 2vh;
        transform: translateX(-0.5vh);
      }

      .setupOptionTile {
        background-color: rgba(255, 255, 255, 0.05);
        border: none;
        border-radius: 2vh;
        padding: 2vh;
        box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.1);
        animation: fadeIn 0.4s ease-in;
      }

      .sidebarButton {
        position: absolute;
        top: 2vh;
        left: 2vh;
        width: 7vh;
        aspect-ratio: 1;
        z-index: 100;
        border-color: var(--bluegreen);
        backdrop-filter: blur(5px);
      }

      .buttonLine {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 60%;
        height: 0.5vh;
        background-color: rgba(255, 255, 255, 0.75);
        border: none;
        border-radius: 1vh;
      }
    </style>
  </head>
  <body>
    <div id="ribbon">
      <button class="windowButton" style="background-color: var(--red)"></button>
      <button class="windowButton" style="background-color: var(--yellow)"></button>
      <button class="windowButton" style="background-color: var(--bluegreen)"></button>
    </div>
    <div id="mobileRibbon">
      <button class="windowButton" style="background-color: rgba(0, 0, 0, 0)"></button>
      <button class="windowButton" style="background-color: rgba(0, 0, 0, 0)"></button>
      <button class="windowButton" style="background-color: rgba(0, 0, 0, 0)"></button>
      <button class="windowButton" style="background-color: var(--red)"></button>
      <button class="windowButton" style="background-color: var(--yellow)"></button>
      <button class="windowButton" style="background-color: var(--bluegreen)"></button>
    </div>
    <div class="mainBody">
      <button id="sidebarButton" class="sidebarButton" onclick="toggleSidebar()">
        <div class="buttonLine" style="top: 30%"></div>
        <div class="buttonLine"></div>
        <div class="buttonLine" style="top: 70%"></div>
      </button>
      <div id="sidebar">
        <br /><br /><br /><br /><br />
        <h2 style="margin-bottom: 10px"><a href="https://ratlabstudio.com" style="color: rgb(108, 224, 228)">Rat Lab Studio</a></h2>
        <br />
        <h2 style="font-weight: normal">ePaper Setup</h2>
        <br />
        <button onclick="openPage('networkPage')">Network</button>
        <br /><br /><br />
        <button onclick="openPage('setupPage')">Setup</button>
        <h3 style="position: absolute; bottom: 5vh; left: 5vh"><a href="https://ratlabstudio.com/help">Need Help?</a></h3>
      </div>
      <div id="documentBody">
        <div class="page" id="networkPage" style="visibility: visible">
          <br /><br /><br /><br />
          <h1>Network Setup</h1>
          <br />
          <p>Input your home network credentials below to allow your device to connect to the internet.</p>
          <br /><br />
          <h2>Network Name</h2>
          <select id="networkOptions" placeholder="SSID"></select>
          <br /><br /><br />
          <h2>Network Password</h2>
          <div class="passwordContainer">
            <input id="password" placeholder="Password" type="password" />
            <button id="showButton" onclick="togglePasswordShow()" style="width: 40%; max-width: 125px">Show</button>
          </div>
          <br /><br /><br />
          <p id="failMessage" style="color: var(--red); visibility: hidden">Connection failed! Double-check your password and try again.</p>
          <br />
          <button id="connectButton" onclick="connect()">Connect</button>
          <br /><br /><br /><br />
        </div>

        <div class="page" id="setupPage" style="visibility: hidden">
          <br /><br /><br /><br />
          <h1>Additional Setup</h1>
          <br />
          <div class="setupOptions">
            <div class="setupOptionTile">
              <h2>Temperature Units</h2>
              <br />
              <button id="tempUnits" class="toggle" onclick="toggleTemp()">Fahrenheit</button>
              <br /><br />
            </div>
            <div class="setupOptionTile">
              <h2>Time Format</h2>
              <br />
              <button id="timeFormat" class="toggle" onclick="toggleTimeFormat()">12hr</button>
              <br /><br />
            </div>
            <div class="setupOptionTile">
              <h2>Date Format</h2>
              <br />
              <button id="dateFormat" class="toggle" onclick="toggleDateFormat()">mm/dd/yy</button>
              <br /><br />
            </div>
            <div class="setupOptionTile">
              <h2>Color Mode</h2>
              <br />
              <button id="colorMode" class="toggle" onclick="toggleColorMode()">Light</button>
              <br /><br />
            </div>
          </div>
          <br /><br /><br />
          <button id="applyButton" onclick="apply()" style="color: var(--bluegreen); border-color: var(--bluegreen); margin-bottom: 5vh">Apply Changes</button>
        </div>
      </div>
    </div>
    <script>
      networkOptions = "%networks%".split(",");
      for (let i = 0; i < networkOptions.length; i++) {
        document.getElementById("networkOptions").innerHTML += `<option value='${networkOptions[i]}'>${networkOptions[i]}</option>`;
      }

      document.getElementById("networkOptions").addEventListener("change", (e) => {});

      function connect() {
        let SSID = document.getElementById("networkOptions").value;
        let password = encodeURIComponent(document.getElementById("password").value);
        document.getElementById("connectButton").innerHTML = "Connecting...";
        let failMessage = document.getElementById("failMessage");
        failMessage.style.visibility = "hidden";
        let failed = false;

        fetch(`/set1?value=${encodeURIComponent(SSID)}`)
          .then((r) => r.text())
          .then((t) => console.log(t))
          .then(() => {
            fetch(`/set2?value=${password}`)
              .then((r) => r.text())
              .then((t) => {
                console.log(t);
                if (t == "failed") {
                  failMessage.innerHTML = "Connection failed! Double-check your password and try again.";
                  failMessage.style.visibility = "visible";
                  document.getElementById("connectButton").innerHTML = "Connect";
                  failed = true;
                } else if (t == "location error") {
                  failMessage.innerHTML = "Error: Location services unavailable!";
                  failMessage.style.visibility = "visible";
                  document.getElementById("connectButton").innerHTML = "Connect";
                  failed = true;
                } else {
                  failMessage.style.visibility = "hidden";
                }
              })
              .then(() => {
                if (!failed) openPage("setupPage");
              });
          });
      }
      document.connect = connect;

      let currentPage = "networkPage";
      function openPage(page) {
        if (document.getElementById(page)) {
          document.getElementById(currentPage).style.visibility = "hidden";
          document.getElementById(page).style.visibility = "visible";
          currentPage = page;
          updateUI();
        } else {
          console.error(`Page ${page} not found!`);
        }
      }
      document.currentPage = currentPage;
      document.openPage = openPage;

      // Temperature Units Handling
      let tempUnitsToggle = document.getElementById("tempUnits");
      let tempUnits = tempUnitsToggle.innerHTML.toLowerCase();
      function toggleTemp() {
        if (tempUnits == "fahrenheit") tempUnitsToggle.innerHTML = "Celsius";
        else tempUnitsToggle.innerHTML = "Fahrenheit";
        tempUnits = tempUnitsToggle.innerHTML.toLowerCase();
      }
      document.toggleTemp = toggleTemp;

      // Temperature Units Handling
      let timeFormatToggle = document.getElementById("timeFormat");
      let timeFormat = timeFormatToggle.innerHTML.toLowerCase();
      function toggleTimeFormat() {
        if (timeFormat == "12hr") timeFormatToggle.innerHTML = "24hr";
        else timeFormatToggle.innerHTML = "12hr";
        timeFormat = timeFormatToggle.innerHTML.toLowerCase();
      }
      document.toggleTimeFormat = toggleTimeFormat;

      function apply() {
        document.getElementById("applyButton").innerHTML = "Applying...";
        fetch(`/set3?value=${tempUnits},${timeFormat},${currentDateFormat},${colorMode}`)
          .then((r) => r.text())
          .then((t) => console.log(t))
          .then(() => (document.getElementById("applyButton").innerHTML = "Apply Changes"));
      }
      document.apply = apply;

      const dateFormatButton = document.getElementById("dateFormat");
      let dateFormats = ["mm/dd/yy", "dd/mm/yy", "yy/mm/dd"];
      let currentDateFormat = 0;
      function toggleDateFormat() {
        currentDateFormat++;
        if (currentDateFormat >= dateFormats.length) currentDateFormat = 0;
        dateFormatButton.innerHTML = dateFormats[currentDateFormat];
      }
      document.toggleDateFormat = toggleDateFormat;

      const colorModeButton = document.getElementById("colorMode");
      let colorMode = colorModeButton.innerHTML;
      function toggleColorMode() {
        if (colorMode == "Light") colorMode = "Dark";
        else colorMode = "Light";
        colorModeButton.innerHTML = colorMode;
      }

      const sidebar = document.getElementById("sidebar");
      const sidebarButton = document.getElementById("sidebarButton");
      const documentBody = document.getElementById("documentBody");
      const ribbon = document.getElementById("ribbon");
      const mobileRibbon = document.getElementById("mobileRibbon");

      function updateUI() {
        if (window.innerWidth < 1200) {
          sidebar.classList.remove("animate");
          sidebar.style.visibility = "hidden";
          sidebar.style.width = "0%";
          documentBody.style.width = "100%";
          sidebarButton.style.visibility = "visible";
          ribbon.style.visibility = "hidden";
          mobileRibbon.style.visibility = "visible";
          try {
            canvas.style.width = "80%";
          } catch {}
        } else {
          sidebar.style.visibility = "visible";
          sidebar.style.width = "15%";
          sidebar.classList.add("animate");
          documentBody.style.width = "80%";
          sidebarButton.style.visibility = "hidden";
          ribbon.style.visibility = "visible";
          mobileRibbon.style.visibility = "hidden";
          try {
            canvas.style.width = "50vh";
          } catch {}
        }
      }

      window.addEventListener("resize", (e) => {
        updateUI();
      });
      updateUI();

      function toggleSidebar() {
        if (sidebar.style.visibility == "hidden") {
          sidebar.style.visibility = "visible";
          sidebar.style.width = "75%";
          sidebar.classList.add("animate");
        } else {
          sidebar.classList.remove("animate");
          sidebar.style.visibility = "hidden";
          sidebar.style.width = "0%";
        }
      }

      const passwordInput = document.getElementById("password");
      const showButton = document.getElementById("showButton");
      function togglePasswordShow() {
        if (passwordInput.type == "password") {
          passwordInput.type = "text";
          showButton.innerHTML = "Hide";
        } else {
          passwordInput.type = "password";
          showButton.innerHTML = "Show";
        }
      }

      document.addEventListener("keypress", (e) => {
        if (e.key == "Enter") {
          if (currentPage == "networkPage") connect();
          else if (currentPage == "setupPage") apply();
        }
      });
    </script>
  </body>
</html>
